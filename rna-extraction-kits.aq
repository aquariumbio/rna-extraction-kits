{"config":{"title":"Aquarium RNA Extraction Kits","description":"Modules to provide `show` methods for working with RNA extraction kits","copyright":"University of Washington","version":"0.0.2","authors":[{"name":"Devin Strickland","affiliation":"University of Washington"}],"maintainer":{"name":"Devin Strickland","email":"strcklnd@uw.edu"},"acknowledgements":null,"github":{"user":"dvnstrcklnd","repo":"aq-rna-extraction-kits","organization":"klavinslab"},"keywords":null,"aquadoc_version":"1.0.2","aquarium_version":"\u003c%= Bioturk::Application.config.aquarium_version %\u003e"},"components":[{"library":{"name":"QIAampDSPViralRNAMiniKit","category":"RNA Extraction Kits","code_source":"# frozen_string_literal: true\n\nneeds 'Standard Libs/Units'\n\n# Module for QIAamp DSP Viral RNA Mini Kit\n#\n# @author Devin Strickland \u003cstrcklnd@uw.edu\u003e\nmodule QIAampDSPViralRNAMiniKit\n  include Units\n\n  NAME = 'QIAamp DSP Viral RNA Mini Kit'\n\n  WASH_TUBE = \"2 #{MILLILITERS} wash tube (WT)\"\n\n  MIN_SAMPLE_VOLUME =     { qty: 140, units: MICROLITERS }.freeze\n  DEFAULT_SAMPLE_VOLUME = MIN_SAMPLE_VOLUME\n  WASH_VOLUME =           { qty: 500, units: MICROLITERS }.freeze\n\n  def prepare_materials\n    show do\n      title 'Things to do before starting'\n      bullet \"Equilibrate samples to room temperature (15-25#{DEGREES_C})\"\n      bullet 'Equilibrate Buffer AVE to room temperature'\n      # TODO: Need some way of indicating this has been done\n      bullet 'Check that Buffer AW1 and Buffer AW2 have been prepared ' \\\n        'according to the instructions'\n      # TODO: Need some way of indicating this has been done\n      bullet 'Add carrier RNA reconstituted in Buffer AVE to Buffer AVL ' \\\n        'according to the instructions'\n    end\n  end\n\n  def notes_on_handling\n    show do\n      title 'Handling of QIAamp Mini spin columns'\n\n      note 'Due to the sensitivity of nucleic acid amplification ' \\\n        'technologies, the following precautions are necessary when handling ' \\\n        'QIAamp Mini spin columns to avoid cross contamination between ' \\\n        'sample preparations:'\n      bullet 'Carefully apply the sample or solution to the QIAamp Mini ' \\\n        'spin column. Pipet the sample into the QIAamp Mini spin column ' \\\n        'without wetting the rim of the column.'\n      bullet 'Always change pipet tips between liquid transfers. ' \\\n        'We recommend the use of aerosol-barrier pipet tips.'\n      bullet 'Avoid touching the QIAamp Mini spin column membrane with ' \\\n        'the pipet tip.'\n      bullet 'After all pulse-vortexing steps, briefly centrifuge the ' \\\n       'microcentrifuge tubes to remove drops from the inside of the lids.'\n      bullet 'Open only one QIAamp Mini spin column at a time, and take care ' \\\n        'to avoid generating aerosols.'\n      bullet 'Wear gloves throughout the entire procedure. In case of ' \\\n        'contact between gloves and sample, change gloves immediately.'\n    end\n  end\n\n  # @todo will we be working with a different sample volume for each operation?\n  # @todo make use_operations do this^\n  def lyse_samples_constant_volume(sample_volume: nil)\n    # TODO: Move this logic up to the calling method\n    if sample_volume[:qty] \u003c MIN_SAMPLE_VOLUME[:qty]\n      msg = \"Sample volume must be \u003e #{qty_display(MIN_SAMPLE_VOLUME)}\"\n      raise ProtocolError, msg\n    end\n    sample_volume ||= DEFAULT_SAMPLE_VOLUME\n    buffer_volume = buffer_avl_volume(sample_volume: sample_volume)\n    ethanol_volume = buffer_volume\n\n    show do\n      title 'Lyse Samples'\n\n      note \"Pipet #{qty_display(buffer_volume)} of prepared Buffer AVL \" \\\n        'containing carrier RNA into a lysis tube (LT).'\n      # If the sample volume is larger than 140 ul, increase the amount of\n      # Buffer AVL-carrier RNA proportionally (e.g., a 280 ul sample will\n      # require 1120 ul Buffer AVL-carrier RNA) and use a larger tube.\n      note \"Add #{qty_display(sample_volume)} plasma, serum, urine, \" \\\n        'cell-culture supernatant, or cell- free body fluid to the ' \\\n        'Buffer AVL-carrier RNA in the lysis tube (LT).'\n      note \"Mix by pulse-vortexing for 15 #{SECONDS}.\"\n      warning 'To ensure efficient lysis, it is essential that the sample ' \\\n        'is mixed thoroughly with Buffer AVL to yield a homogeneous solution'\n      # Frozen samples that have only been thawed once can also be used.\n      note \"Incubate at room temperature (15-25#{DEGREES_C}) for 10 #{MINUTES}\"\n    end\n\n    show do\n      title 'Add Ethanol'\n\n      note 'Briefly centrifuge the lysis tube (LT) to remove drops from ' \\\n        'the inside of the lid.'\n      note \"Add #{qty_display(ethanol_volume)} ethanol (96-100%) to the \" \\\n        'sample, and mix by pulse-vortexing for \u003e15 seconds. ' \\\n        'After mixing, briefly centrifuge the tube to remove drops from ' \\\n        'inside the lid.'\n      # Only ethanol should be used since other alcohols may result in\n      # reduced RNA yield and purity. Do not use denatured alcohol, which\n      # contains other substances such as methanol or methylethylketone.\n      # If the sample volume is greater than 140 ul, increase the amount of\n      # ethanol proportionally (e.g., a 280 ul sample will require\n      # 1120 ul of ethanol). In order to ensure efficient binding, it is\n      # essential that the sample is mixed thoroughly with the ethanol\n      # to yield a homogeneous solution.\n    end\n  end\n\n  def lyse_samples_variable_volume(operations:)\n    msg = 'Method lyse_samples_variable_volume is not supported for ' \\\n      'QIAamp DSP Viral RNA Mini Kit'\n    raise ProtocolError, msg\n  end\n\n  def bind_rna\n    show do\n      title 'Add Samples to Columns'\n\n      note 'Carefully apply 630 #{MICROLITERS} of the solution from step 5 to the ' \\\n        'QIAamp Mini spin column (in a wash tube (WT)) without wetting the rim.'\n      note \"Close the cap, and centrifuge at approximately 6000 #{TIMES_G} \" \\\n        \"for \u003e1 #{MINUTES}. Place the QIAamp Mini spin column into a clean\" \\\n        \"#{WASH_TUBE}, and discard the wash tube containing \" \\\n        'the filtrate.'\n      warning 'Close each spin column in order to avoid cross-contamination ' \\\n        'during centrifugation.'\n      # Centrifugation is performed at approximately 6000 x g in order to limit\n      # microcentrifuge noise. Centrifugation at full speed will not affect the\n      # yield or purity of the viral RNA. If the solution has not completely\n      # passed through the membrane, centrifuge again at a higher speed\n      # until all of the solution has passed through.\n      separator\n\n      note 'Carefully open the QIAamp Mini spin column, and repeat step 6.'\n      note 'Repeat this step until all of the lysate has been loaded onto ' \\\n        'the spin column.'\n    end\n  end\n\n  def wash_rna\n    show do\n      title 'Wash with Buffer AW1'\n\n      note 'Carefully open the QIAamp Mini spin column, and add ' \\\n        \"#{qty_display(WASH_VOLUME)} Buffer AW1.\"\n      note 'Close the cap, and centrifuge at approximately ' \\\n        \"6000 #{TIMES_G} for \u003e1 #{MINUTES}.\"\n      note \"Place the QIAamp Mini spin column in a clean #{WASH_TUBE}, \" \\\n        'and discard the wash tube containing the filtrate.'\n      # It is not necessary to increase the volume of Buffer AW1 even if the\n      # original sample volume was larger than 140 ul.\n    end\n\n    show do\n      title 'Wash with Buffer AW1'\n\n      note 'Carefully open the QIAamp Mini spin column, and add ' \\\n        \"#{qty_display(WASH_VOLUME)} Buffer AW2.\"\n      note 'Close the cap and centrifuge at full speed ' \\\n        \"(approximately 20,000 #{TIMES_G}) for 3 #{MINUTES}.\"\n      separator\n\n      note \"Place the QIAamp Mini spin column in a new #{WASH_TUBE}, \" \\\n        'and discard the wash tube containing the filtrate. '\n      note \"Centrifuge at full speed for 1 #{MINUTES}.\"\n    end\n  end\n\n  def elute_rna\n    show do\n      title 'Elute RNA'\n\n      note 'Place the QIAamp Mini spin column in a clean elution tube (ET).'\n      note 'Discard the wash tube containing the filtrate.'\n      note 'Carefully open the QIAamp Mini spin column and add ' \\\n        \"60 #{MICROLITERS} of Buffer AVE equilibrated to room temperature.\"\n      note \"Close the cap, and incubate at room temperature for \u003e1 #{MINUTES}.\"\n      note \"Centrifuge at approximately 6000 #{TIMES_G} for \u003e1 #{MINUTES}.\"\n    end\n  end\n\n  private\n\n  def buffer_avl_volume(sample_volume:)\n    unless sample_volume[:units] == MICROLITERS\n      raise ProtocolError, \"Parameter :sample_volume must be in #{MICROLITERS}\"\n    end\n\n    qty = sample_volume[:qty] * 560 / 140\n    { qty: qty, units: MICROLITERS }\n  end\nend\n"}},{"library":{"name":"RNAExtractionKits","category":"RNA Extraction Kits","code_source":"# frozen_string_literal: true\n\nneeds 'RNAExtractionKits/TestRNAExtractionKit'\nneeds 'RNAExtractionKits/QIAampDSPViralRNAMiniKit'\n\n# Module for switching among several different RNA extraction kits\n#\n# @author Devin Strickland \u003cstrcklnd@uw.edu\u003e\nmodule RNAExtractionKits\n  # Extend the module with the correct methods based on the kit name\n  #\n  # @param name [String] the name of the kit\n  # @return [void]\n  def set_kit(name:)\n    case name\n    when TestRNAExtractionKit::NAME\n      extend TestRNAExtractionKit\n    when QIAampDSPViralRNAMiniKit::NAME\n      extend QIAampDSPViralRNAMiniKit\n    else\n      raise ProtocolError, \"Unrecognized RNA Extraction Kit: #{name}\"\n    end\n  end\n\n  # Run the protocol defined by the kit\n  #\n  # @note if `sample_volume` is provided, then all samples will be run\n  #   using that volume of sample\n  # @note if `sample_volume` is not provided, but `operations` are, then\n  #   the protocol will look for sample_volumes assigned to the `Operations`\n  # @note if neither `sample_volume` nor `operations` are provided, then\n  #   all samples will be run using `DEFAULT_SAMPLE_VOLUME`\n  # @param operations [OperationList] the operations to run\n  # @param sample_volume [Hash] the volume as a Hash in the format\n  #   `{ qty: 140, units: MICROLITERS }`\n  # @return [void]\n  def run_rna_extraction_kit(operations: [], sample_volume: nil)\n    prepare_materials\n\n    notes_on_handling\n\n    if sample_volume\n      lyse_samples_constant_volume(sample_volume: sample_volume)\n    elsif operations.present?\n      lyse_samples_variable_volume(operations: operations)\n    else\n      lyse_samples_constant_volume\n    end\n\n    bind_rna\n\n    wash_rna\n\n    elute_rna\n  end\nend\n"}},{"library":{"name":"TestRNAExtractionKit","category":"RNA Extraction Kits","code_source":"# frozen_string_literal: true\n\nneeds 'Standard Libs/Units'\n\n# Minimal RNA Extraction Kit Module for testing\n#\n# @author Devin Strickland \u003cstrcklnd@uw.edu\u003e\nmodule TestRNAExtractionKit\n  include Units\n\n  NAME = 'Test RNA Extraction Kit'\n\n  MIN_SAMPLE_VOLUME =     { qty: 140, units: MICROLITERS }.freeze\n  DEFAULT_SAMPLE_VOLUME = MIN_SAMPLE_VOLUME\n\n  def prepare_materials\n    show do\n      title 'Things to do before starting'\n    end\n  end\n\n  def notes_on_handling\n    show do\n      title 'Handling Materials'\n    end\n  end\n\n  def lyse_samples_constant_volume(sample_volume:)\n    show do\n      title 'Lyse Samples Constant Volume'\n\n      note \"Sample volume: #{qty_display(sample_volume)}\"\n    end\n  end\n\n  def lyse_samples_variable_volume(operations:)\n    show do\n      title 'Lyse Samples Variable Volume'\n\n      operations.each { |op| note \"Sample volume: #{sample_volume(op)}\" }\n    end\n  end\n\n  def bind_rna\n    show do\n      title 'Add Samples to Columns'\n    end\n  end\n\n  def wash_rna\n    show do\n      title 'Wash with Buffer'\n    end\n  end\n\n  def elute_rna\n    show do\n      title 'Elute RNA'\n    end\n  end\n\n  private\n\n  def sample_volume(operation)\n    operation.input('Options').val.fetch(:sample_volume)\n  end\n\nend"}},{"sample_types":[],"object_types":[],"operation_type":{"name":"RNA Extraction Test","category":"Test","deployed":false,"on_the_fly":false,"field_types":[{"ftype":"json","role":"input","name":"Options","sample_types":[],"object_types":[],"part":false,"array":false,"routing":null,"preferred_operation_type_id":null,"preferred_field_type_id":null,"choices":null}],"protocol":"# frozen_string_literal: true\n\nneeds 'Standard Libs/PlanParams'\nneeds 'Standard Libs/Units'\nneeds 'Standard Libs/Debug'\nneeds 'RNAExtractionKits/RNAExtractionKits'\n\n# Test Extract RNA Protocol\n#\n# @author Devin Strickland \u003cstrcklnd@uw.edu\u003e\nclass Protocol\n  include PlanParams\n  include Units\n  include Debug\n  include RNAExtractionKits\n\n  ########## DEFAULT PARAMS ##########\n\n  # Default parameters that are applied equally to all operations.\n  #   Can be overridden by:\n  #   * Associating a JSON-formatted list of key, value pairs to the `Plan`.\n  #   * Adding a JSON-formatted list of key, value pairs to an `Operation`\n  #     input of type JSON and named `Options`.\n  #\n  def default_job_params\n    {\n      rna_extraction_kit: TestRNAExtractionKit::NAME\n    }\n  end\n\n  # Default parameters that are applied to individual operations.\n  #   Can be overridden by:\n  #   * Adding a JSON-formatted list of key, value pairs to an `Operation`\n  #     input of type JSON and named `Options`.\n  #\n  def default_operation_params\n    {\n      sample_volume: { qty: 200, units: MICROLITERS }\n\n    }\n  end\n\n  ########## MAIN ##########\n\n  def main\n    setup_test_options(operations: operations) if debug\n\n    @job_params = update_all_params(\n      operations: operations,\n      default_job_params: default_job_params,\n      default_operation_params: default_operation_params\n    )\n    return {} if operations.errored.any?\n\n    operations.retrieve.make\n\n    set_kit(name: @job_params[:rna_extraction_kit])\n\n    sample_volumes = operation_sample_volumes(operations)\n    if sample_volumes.uniq.length == 1\n      run_rna_extraction_kit(sample_volume: sample_volumes.first)\n    else\n      run_rna_extraction_kit(operations: operations)\n    end\n\n    operations.store\n\n    {}\n  end\n\n  def operation_sample_volumes(operations)\n    operations.map { |op| op.temporary[:options][:sample_volume] }\n  end\nend\n","precondition":"def precondition(_op)\n  true\nend","cost_model":"def cost(_op)\n  { labor: 0, materials: 0 }\nend","documentation":"Documentation here. Start with a paragraph, not a heading or title, as in most views, the title will be supplied by the view.","test":"# frozen_string_literal: true\n\nclass ProtocolTest \u003c ProtocolTestBase\n  def setup\n    add_random_operations(1)\n\n    # Use this if you want to test alternative extraction kits\n    # add_operation\n    #   .with_property(\n    #     'Options',\n    #     '{ \"rna_extraction_kit\": \"QIAamp DSP Viral RNA Mini Kit\" }'\n    #   )\n  end\n\n  def analyze\n    log('Hello from Nemo')\n    assert_equal(@backtrace.last[:operation], 'complete')\n  end\nend\n","timing":null}}]}
